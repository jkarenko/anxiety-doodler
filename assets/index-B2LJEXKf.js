var I=Object.defineProperty;var F=(o,t,i)=>t in o?I(o,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[t]=i;var a=(o,t,i)=>F(o,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function i(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=i(e);fetch(e.href,n)}})();var l=(o=>(o.NONE="none",o.HAMMER="hammer",o.EXPLOSION="explosion",o.FIRE="fire",o))(l||{});class D{constructor(){a(this,"isDrawingActive",!1);a(this,"currentDestructionMethod","none");a(this,"isAnimating",!1)}isDrawing(){return this.isDrawingActive}setDrawing(t){this.isDrawingActive=t}getDestructionMethod(){return this.currentDestructionMethod}setDestructionMethod(t){this.currentDestructionMethod=t}isAnimationPlaying(){return this.isAnimating}setAnimating(t){this.isAnimating=t}reset(){this.isDrawingActive=!1,this.currentDestructionMethod="none",this.isAnimating=!1}}class L{constructor(t){a(this,"canvas");a(this,"ctx");a(this,"container");this.container=t,this.canvas=document.createElement("canvas"),this.canvas.className="drawing-canvas",t.appendChild(this.canvas);const i=this.canvas.getContext("2d");if(!i)throw new Error("Could not get 2D context from canvas");this.ctx=i,this.resizeCanvas(),window.addEventListener("resize",this.resizeCanvas.bind(this)),window.addEventListener("orientationchange",this.resizeCanvas.bind(this))}resizeCanvas(){const t=window.innerWidth<=480,i=window.innerWidth<=768,s=window.innerWidth>768&&window.innerWidth<=1024;let e,n;t?(e=this.container.clientWidth*.95,n=this.container.clientHeight*.8):i?(e=this.container.clientWidth*.95,n=this.container.clientHeight*.85):s?(e=this.container.clientWidth*.9,n=this.container.clientHeight*.85):(e=Math.min(900,this.container.clientWidth*.9),n=Math.min(700,this.container.clientHeight*.9)),this.canvas.width=e,this.canvas.height=n,this.canvas.style.width=`${e}px`,this.canvas.style.height=`${n}px`,this.ctx.setTransform(1,0,0,1,0,0),this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.lineWidth=5,this.ctx.strokeStyle="#000000"}getElement(){return this.canvas}getContext(){return this.ctx}getWidth(){return this.canvas.width}getHeight(){return this.canvas.height}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}class W{constructor(){a(this,"paths",[]);a(this,"currentPath",null);a(this,"lineWidth",5);a(this,"lineColor","#000000")}startPath(t,i){this.currentPath={points:[{x:t,y:i}],color:this.lineColor,width:this.lineWidth},this.paths.push(this.currentPath)}addPoint(t,i){if(!this.currentPath){this.startPath(t,i);return}this.currentPath.points.push({x:t,y:i})}endPath(){this.currentPath=null}getPaths(){return this.paths}setPaths(t){this.paths=t,this.currentPath=null}clearPaths(){this.paths=[],this.currentPath=null}setLineWidth(t){this.lineWidth=t}getLineWidth(){return this.lineWidth}setLineColor(t){this.lineColor=t}getLineColor(){return this.lineColor}}class H{constructor(t){a(this,"ctx");this.ctx=t}clear(){const t=this.ctx.canvas;this.ctx.clearRect(0,0,t.width,t.height)}drawPath(t){const{points:i,color:s,width:e}=t;if(i.length<2){if(i.length===1){const n=i[0];this.ctx.beginPath(),this.ctx.arc(n.x,n.y,e/2,0,Math.PI*2),this.ctx.fillStyle=s,this.ctx.fill()}return}this.ctx.strokeStyle=s,this.ctx.lineWidth=e,this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(i[0].x,i[0].y);for(let n=1;n<i.length;n++)this.ctx.lineTo(i[n].x,i[n].y);this.ctx.stroke()}drawDoodle(t){for(const i of t)this.drawPath(i)}getContext(){return this.ctx}setContext(t){this.ctx=t}}class c{constructor(t=0,i=0){this.x=t,this.y=i}clone(){return new c(this.x,this.y)}add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}multiply(t){return this.x*=t,this.y*=t,this}divide(t){return t!==0&&(this.x/=t,this.y/=t),this}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.magnitude();return t>0&&this.divide(t),this}setMagnitude(t){return this.normalize(),this.multiply(t),this}dot(t){return this.x*t.x+this.y*t.y}distance(t){const i=this.x-t.x,s=this.y-t.y;return Math.sqrt(i*i+s*s)}limit(t){return this.magnitude()>t&&(this.normalize(),this.multiply(t)),this}heading(){return Math.atan2(this.y,this.x)}rotate(t){const i=this.heading()+t,s=this.magnitude();return this.x=Math.cos(i)*s,this.y=Math.sin(i)*s,this}static fromAngle(t,i=1){return new c(Math.cos(t)*i,Math.sin(t)*i)}static random2D(){return c.fromAngle(Math.random()*Math.PI*2)}}class y{constructor(t,i){a(this,"particles",[]);a(this,"origin");a(this,"gravity");this.origin=new c(t,i),this.gravity=new c(0,.1)}setOrigin(t,i){this.origin.x=t,this.origin.y=i}setGravity(t,i){this.gravity.x=t,this.gravity.y=i}addParticle(t=this.origin.x,i=this.origin.y,s="#FF5722",e=5,n=60){const r={position:new c(t,i),velocity:c.random2D().multiply(Math.random()*2+1),acceleration:this.gravity.clone(),color:s,size:e,life:n,maxLife:n,isDead:!1};this.particles.push(r)}addParticles(t,i=this.origin.x,s=this.origin.y,e="#FF5722",n=[3,8],r=[30,90]){for(let h=0;h<t;h++){const m=Math.random()*(n[1]-n[0])+n[0],d=Math.floor(Math.random()*(r[1]-r[0])+r[0]);this.addParticle(i,s,e,m,d)}}addParticlesFromPoints(t,i=.5,s="#FF5722",e=[3,8],n=[30,90]){const r=Math.max(1,Math.floor(t.length*i)),h=Math.floor(t.length/r);for(let m=0;m<t.length;m+=h){const d=t[m],P=Math.random()*(e[1]-e[0])+e[0],g=Math.floor(Math.random()*(n[1]-n[0])+n[0]),u=2,f=d.x+(Math.random()*u*2-u),A=d.y+(Math.random()*u*2-u);this.addParticle(f,A,s,P,g)}}update(){for(let t=this.particles.length-1;t>=0;t--){const i=this.particles[t];i.velocity.add(i.acceleration),i.position.add(i.velocity),i.acceleration.multiply(0),i.life--,i.life<=0&&(i.isDead=!0,this.particles.splice(t,1))}}applyForce(t){for(const i of this.particles)i.acceleration.add(t)}draw(t){for(const i of this.particles){const s=i.life/i.maxLife;t.save(),t.globalAlpha=s,t.fillStyle=i.color,t.beginPath(),t.arc(i.position.x,i.position.y,i.size,0,Math.PI*2),t.fill(),t.restore()}}isEmpty(){return this.particles.length===0}getParticleCount(){return this.particles.length}clear(){this.particles=[]}}const p=new Map,x={hammerImpact:"./sounds/hammer-impact.mp3",softImpact:"./sounds/soft-impact.mp3",hardImpact:"./sounds/hard-impact.mp3",whoosh:"./sounds/whoosh.mp3",swipe:"./sounds/swipe.mp3",explosion:"./sounds/explosion.mp3",smallExplosion:"./sounds/small-explosion.mp3",fire:"./sounds/fire.mp3",burn:"./sounds/burn.mp3",pop:"./sounds/pop.mp3",bounce:"./sounds/bounce.mp3",crumble:"./sounds/crumble.mp3"};let b=.7;function C(o,t){if(!p.has(o)){const i=new Audio(t);i.preload="auto",p.set(o,i),i.load()}}function S(o,t,i=!1){!p.has(o)&&o in x&&C(o,x[o]);const s=p.get(o);if(s){const e=new Audio(s.src);return e.volume=b,e.loop=i,setTimeout(()=>{e.play().catch(n=>{console.error(`Error playing sound "${o}":`,n)})},0),e}console.warn(`Sound "${o}" not found in audio cache`)}function R(o){o&&(o.pause(),o.currentTime=0)}function O(o){return S("hammerImpact")}const B=[{start:0,duration:.5},{start:.5,duration:.5},{start:1,duration:.5},{start:1.5,duration:.5}],X=[{start:0,duration:1},{start:1,duration:1},{start:2,duration:1},{start:3,duration:1}];function E(o,t,i){!p.has(o)&&o in x&&C(o,x[o]);const s=p.get(o);if(s){const e=new Audio(s.src);e.volume=b;const n=t[Math.floor(Math.random()*t.length)];return e.currentTime=n.start,setTimeout(()=>{e.play().catch(r=>{console.error(`Error playing sound "${o}":`,r)}),setTimeout(()=>{R(e)},n.duration*1e3)},0),e}console.warn(`Sound "${o}" not found in audio cache`)}function M(o){return E("whoosh",B)}function v(o=!1,t){return S(o?"smallExplosion":"explosion")}function N(o){return E("crumble",X)}function Y(o){return S("pop")}class T{constructor(t,i,s){a(this,"ctx");a(this,"canvasWidth");a(this,"canvasHeight");a(this,"hammerImg");a(this,"hammerX");a(this,"hammerY");a(this,"hammerRotation",-Math.PI/4);a(this,"hammerScale",1);a(this,"isAnimating",!1);a(this,"animationProgress",0);a(this,"animationDuration",60);a(this,"particleSystem");a(this,"paths",[]);a(this,"originalPaths",[]);a(this,"smashPoint");a(this,"centerLineX",0);a(this,"highestPointY",0);a(this,"smashCount",0);a(this,"totalSmashes",1);a(this,"pathScaleFactor",1);a(this,"onComplete",()=>{});this.ctx=t,this.canvasWidth=i,this.canvasHeight=s,this.hammerImg=new Image,this.hammerImg.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNMzAgMjBINzBWNDBIMzBWMjBaIiBmaWxsPSIjODg4Ii8+PHBhdGggZD0iTTQ1IDQwSDU1VjgwSDQ1VjQwWiIgZmlsbD0iIzYxNDEyNiIvPjwvc3ZnPg==",this.hammerX=this.canvasWidth/2,this.hammerY=0,this.smashPoint=new c(this.canvasWidth/2,this.canvasHeight/2),this.particleSystem=new y(this.smashPoint.x,this.smashPoint.y)}setPaths(t){(this.paths.length===0||this.originalPaths.length===0)&&(this.paths=JSON.parse(JSON.stringify(t)),this.originalPaths=JSON.parse(JSON.stringify(t)))}findCenterLineX(){if(this.paths.length===0)return this.canvasWidth/2;let t=Number.MAX_VALUE,i=Number.MIN_VALUE;for(const s of this.paths)for(const e of s.points)t=Math.min(t,e.x),i=Math.max(i,e.x);return(t+i)/2}findHighestPointOnCenterLine(){if(this.paths.length===0)return this.canvasHeight/2;let t=this.canvasHeight;const i=5;for(const s of this.paths)for(let e=0;e<s.points.length-1;e++){const n=s.points[e],r=s.points[e+1];if(n.x<=this.centerLineX&&r.x>=this.centerLineX||n.x>=this.centerLineX&&r.x<=this.centerLineX||Math.abs(n.x-this.centerLineX)<i||Math.abs(r.x-this.centerLineX)<i){let h;if(Math.abs(r.x-n.x)<.001)h=Math.min(n.y,r.y);else{const m=(this.centerLineX-n.x)/(r.x-n.x);h=n.y+m*(r.y-n.y)}t=Math.min(t,h)}}return t}findLowestPoint(){const t=this.pathScaleFactor===1?this.originalPaths:this.paths;if(t.length===0)return this.canvasHeight;let i=0;for(const s of t)for(const e of s.points)i=Math.max(i,e.y);return i}flattenPaths(t){this.pathScaleFactor===1&&(this.paths=JSON.parse(JSON.stringify(this.originalPaths)));const i=this.findLowestPoint();for(const s of this.paths)for(const e of s.points)e.y=i-(i-e.y)*t}setOnComplete(t){this.onComplete=t}start(){this.isAnimating||(this.isAnimating=!0,this.animationProgress=0,this.smashCount=0,M(),this.centerLineX=this.findCenterLineX(),this.highestPointY=this.findHighestPointOnCenterLine(),this.smashPoint.x=this.centerLineX,this.smashPoint.y=this.highestPointY,this.hammerX=this.centerLineX,this.hammerY=-50,this.particleSystem.setOrigin(this.smashPoint.x,this.smashPoint.y),this.particleSystem.clear(),console.log(`Starting hammer animation: centerLineX=${this.centerLineX}, highestPointY=${this.highestPointY}`))}update(){if(!this.isAnimating)return!1;if(this.animationProgress++,this.animationProgress<this.animationDuration*.3){const t=this.animationProgress/(this.animationDuration*.3);this.hammerRotation=-Math.PI/4+t*Math.PI/2,this.hammerY=-50+t*(this.smashPoint.y+50)}else if(this.animationProgress<this.animationDuration*.4){this.animationProgress===Math.floor(this.animationDuration*.3)&&(O(),this.createImpactParticles(),this.smashCount++,console.log(`Smash ${this.smashCount} of ${this.totalSmashes}`),this.pathScaleFactor*=.8,this.flattenPaths(this.pathScaleFactor),N(),this.highestPointY=this.findHighestPointOnCenterLine(),this.smashPoint.y=this.highestPointY);const t=3;this.hammerX=this.smashPoint.x+(Math.random()*2-1)*t,this.hammerY=this.smashPoint.y+(Math.random()*2-1)*t}else{const t=(this.animationProgress-this.animationDuration*.4)/(this.animationDuration*.6);this.hammerRotation=Math.PI/4-t*Math.PI/2,this.hammerY=this.smashPoint.y+50-t*(this.smashPoint.y+100),this.hammerX=this.smashPoint.x}if(this.particleSystem.update(),this.animationProgress>=this.animationDuration)if(this.smashCount<this.totalSmashes)this.animationProgress=0,this.hammerX=this.centerLineX,this.hammerY=-50,this.hammerRotation=-Math.PI/4,this.particleSystem.clear(),M(),console.log(`Starting next smash at y=${this.highestPointY}`);else return this.isAnimating=!1,this.onComplete(),!1;return!0}createImpactParticles(){for(const i of this.paths)this.particleSystem.addParticlesFromPoints(i.points,.3,i.color,[2,5],[30,60]);this.particleSystem.addParticles(20,this.smashPoint.x,this.smashPoint.y,"#FFF",[3,8],[20,40]);const t=new c(0,-.2);this.particleSystem.applyForce(t)}draw(){if(!(!this.isAnimating&&this.particleSystem.isEmpty())){if(this.paths.length>0){for(const t of this.paths)if(!(t.points.length<2)){this.ctx.beginPath(),this.ctx.strokeStyle=t.color,this.ctx.lineWidth=t.width,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.moveTo(t.points[0].x,t.points[0].y);for(let i=1;i<t.points.length;i++)this.ctx.lineTo(t.points[i].x,t.points[i].y);this.ctx.stroke()}}this.particleSystem.draw(this.ctx),this.isAnimating&&(this.ctx.save(),this.ctx.translate(this.hammerX,this.hammerY),this.ctx.rotate(this.hammerRotation),this.ctx.scale(this.hammerScale,this.hammerScale),this.ctx.drawImage(this.hammerImg,-60/2,-100/2,60,100),this.ctx.restore())}}isPlaying(){return this.isAnimating||!this.particleSystem.isEmpty()}getPaths(){return this.paths}stop(){this.isAnimating=!1,this.particleSystem.clear()}reset(){this.paths=[],this.originalPaths=[],this.pathScaleFactor=1,this.animationProgress=0,this.smashCount=0,this.hammerRotation=-Math.PI/4,this.hammerX=this.canvasWidth/2,this.hammerY=0,this.stop()}}class z{constructor(t,i,s){a(this,"ctx");a(this,"canvasWidth");a(this,"canvasHeight");a(this,"particleSystem");a(this,"paths",[]);a(this,"isAnimating",!1);a(this,"animationProgress",0);a(this,"animationDuration",90);a(this,"explosionCenter");a(this,"explosionRadius",0);a(this,"maxExplosionRadius",100);a(this,"onComplete",()=>{});a(this,"explosionRings",[]);this.ctx=t,this.canvasWidth=i,this.canvasHeight=s,this.explosionCenter=new c(this.canvasWidth/2,this.canvasHeight/2),this.particleSystem=new y(this.explosionCenter.x,this.explosionCenter.y)}setPaths(t){this.paths=t}setOnComplete(t){this.onComplete=t}start(){if(!this.isAnimating){if(this.isAnimating=!0,this.animationProgress=0,this.explosionRadius=0,this.explosionRings=[],this.paths.length>0){let t=0,i=0,s=0;for(const e of this.paths)for(const n of e.points)t+=n.x,i+=n.y,s++;s>0&&(this.explosionCenter.x=t/s,this.explosionCenter.y=i/s)}this.particleSystem.setOrigin(this.explosionCenter.x,this.explosionCenter.y),this.particleSystem.clear(),this.createExplosionParticles(),v()}}update(){if(!this.isAnimating)return!1;if(this.animationProgress++,this.animationProgress<this.animationDuration*.2){const i=this.animationProgress/(this.animationDuration*.2);this.explosionRadius=this.maxExplosionRadius*i,this.animationProgress%5===0&&(this.addExplosionRing(),Y())}else this.animationProgress%15===0&&this.animationProgress<this.animationDuration*.6&&(this.addSecondaryExplosion(),v(!0));for(let i=this.explosionRings.length-1;i>=0;i--){const s=this.explosionRings[i];s.radius+=s.speed,s.alpha-=.02,s.alpha<=0&&this.explosionRings.splice(i,1)}this.particleSystem.update();const t=new c(0,.05);return this.particleSystem.applyForce(t),this.animationProgress>=this.animationDuration&&this.particleSystem.isEmpty()?(this.isAnimating=!1,this.onComplete(),!1):!0}createExplosionParticles(){for(const t of this.paths)this.particleSystem.addParticlesFromPoints(t.points,.5,t.color,[2,6],[40,80]);this.particleSystem.addParticles(30,this.explosionCenter.x,this.explosionCenter.y,"#FFA500",[4,10],[30,60]);for(let t=0;t<10;t++){const i=Math.random()*Math.PI*2,s=c.fromAngle(i,.3+Math.random()*.3);this.particleSystem.applyForce(s)}}addSecondaryExplosion(){if(this.particleSystem.getParticleCount()>0){const t=new c((Math.random()*2-1)*50,(Math.random()*2-1)*50),i=new c(this.explosionCenter.x+t.x,this.explosionCenter.y+t.y);this.particleSystem.addParticles(10,i.x,i.y,"#FF4500",[3,8],[20,40]),this.explosionRings.push({x:i.x,y:i.y,radius:5,maxRadius:30+Math.random()*20,speed:1+Math.random(),alpha:.8,color:"#FF4500"})}}addExplosionRing(){this.explosionRings.push({x:this.explosionCenter.x,y:this.explosionCenter.y,radius:this.explosionRadius*.5,maxRadius:this.maxExplosionRadius,speed:2+Math.random()*2,alpha:.7,color:"#FFA500"})}draw(){if(!(!this.isAnimating&&this.particleSystem.isEmpty()&&this.explosionRings.length===0)){for(const t of this.explosionRings)this.ctx.save(),this.ctx.globalAlpha=t.alpha,this.ctx.strokeStyle=t.color,this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.stroke(),this.ctx.restore();this.particleSystem.draw(this.ctx)}}isPlaying(){return this.isAnimating||!this.particleSystem.isEmpty()||this.explosionRings.length>0}stop(){this.isAnimating=!1,this.particleSystem.clear(),this.explosionRings=[]}reset(){this.paths=[],this.animationProgress=0,this.explosionRadius=0,this.explosionCenter=new c(this.canvasWidth/2,this.canvasHeight/2),this.stop()}}class U{constructor(t,i,s){a(this,"ctx");a(this,"canvasWidth");a(this,"canvasHeight");a(this,"particleSystem");a(this,"paths",[]);a(this,"isAnimating",!1);a(this,"animationProgress",0);a(this,"animationDuration",120);a(this,"burnPoints",[]);a(this,"onComplete",()=>{});a(this,"burnedSegments",0);a(this,"totalSegments",0);a(this,"fireColors",["#FF4500","#FF7F50","#FFA500","#FFD700","#FFFF00"]);this.ctx=t,this.canvasWidth=i,this.canvasHeight=s,this.particleSystem=new y(this.canvasWidth/2,this.canvasHeight),this.particleSystem.setGravity(0,-.05)}setPaths(t){this.paths=t,this.totalSegments=0;for(const i of t)i.points.length>1&&(this.totalSegments+=i.points.length-1)}setOnComplete(t){this.onComplete=t}start(){this.isAnimating||(this.isAnimating=!0,this.animationProgress=0,this.burnPoints=[],this.burnedSegments=0,this.particleSystem.clear(),this.initializeBurnPoints())}initializeBurnPoints(){for(let t=0;t<this.paths.length;t++){const i=this.paths[t];if(i.points.length<2)continue;let s=0,e=i.points[0].y;for(let n=1;n<i.points.length;n++)i.points[n].y>e&&(e=i.points[n].y,s=n);this.burnPoints.push({pathIndex:t,segmentIndex:s>0?s-1:0,progress:0,position:new c(i.points[s].x,i.points[s].y),speed:.05+Math.random()*.05,active:!0})}}update(){if(!this.isAnimating)return!1;if(this.animationProgress++,this.updateBurnPoints(),this.particleSystem.update(),this.animationProgress%10===0){const t=new c((Math.random()*2-1)*.02,0);this.particleSystem.applyForce(t)}return this.burnedSegments>=this.totalSegments&&this.particleSystem.getParticleCount()<5||this.animationProgress>=this.animationDuration?(this.isAnimating=!1,this.onComplete(),!1):!0}updateBurnPoints(){for(let t=this.burnPoints.length-1;t>=0;t--){const i=this.burnPoints[t];if(!i.active)continue;const s=this.paths[i.pathIndex],e=i.segmentIndex;if(e<s.points.length-1){const n=s.points[e],r=s.points[e+1];if(i.progress+=i.speed,i.progress>=1&&(i.segmentIndex++,i.progress=0,this.burnedSegments++,this.createFireParticles(n,r),i.segmentIndex>=s.points.length-1)){this.createFireParticles(s.points[s.points.length-2],s.points[s.points.length-1]),i.active=!1,this.burnedSegments++;continue}const h=n.x+(r.x-n.x)*i.progress,m=n.y+(r.y-n.y)*i.progress;i.position.x=h,i.position.y=m,this.animationProgress%2===0&&this.createEmberParticle(i.position.x,i.position.y)}}this.animationProgress%30===0&&this.burnPoints.length<10&&this.addRandomBurnPoint()}addRandomBurnPoint(){const t=this.burnPoints.filter(n=>n.active);if(t.length===0)return;const i=t[Math.floor(Math.random()*t.length)],s=this.paths[i.pathIndex],e=Math.max(0,i.segmentIndex-Math.floor(Math.random()*3));if(e<s.points.length-1){const n=s.points[e];this.burnPoints.push({pathIndex:i.pathIndex,segmentIndex:e,progress:0,position:new c(n.x,n.y),speed:.03+Math.random()*.04,active:!0})}}createFireParticles(t,i){const s=i.x-t.x,e=i.y-t.y,n=Math.sqrt(s*s+e*e),r=Math.max(3,Math.floor(n/5));for(let h=0;h<r;h++){const m=h/(r-1),d=t.x+s*m,P=t.y+e*m;for(let g=0;g<3;g++){const u=this.fireColors[Math.floor(Math.random()*this.fireColors.length)],f=3;this.particleSystem.addParticle(d+(Math.random()*2-1)*f,P+(Math.random()*2-1)*f,u,2+Math.random()*4,20+Math.random()*30)}}}createEmberParticle(t,i){const s=this.fireColors[Math.floor(Math.random()*this.fireColors.length)];this.particleSystem.addParticle(t+(Math.random()*2-1)*2,i+(Math.random()*2-1)*2,s,1+Math.random()*2,10+Math.random()*20)}draw(){!this.isAnimating&&this.particleSystem.isEmpty()||this.particleSystem.draw(this.ctx)}isPlaying(){return this.isAnimating||!this.particleSystem.isEmpty()}stop(){this.isAnimating=!1,this.particleSystem.clear(),this.burnPoints=[]}reset(){this.paths=[],this.totalSegments=0,this.burnedSegments=0,this.animationProgress=0,this.stop()}}class j{constructor(t){a(this,"gameState");a(this,"canvas");a(this,"doodleManager");a(this,"renderer");a(this,"animationFrameId",null);a(this,"hammerSmash");a(this,"exploder");a(this,"burner");a(this,"destructionButtons");a(this,"destructionMethodUsed",!1);this.gameState=new D,this.canvas=new L(t),this.doodleManager=new W,this.renderer=new H(this.canvas.getContext());const i=this.canvas.getContext(),s=this.canvas.getWidth(),e=this.canvas.getHeight();this.hammerSmash=new T(i,s,e),this.exploder=new z(i,s,e),this.burner=new U(i,s,e),this.hammerSmash.setOnComplete(()=>this.onAnimationComplete()),this.exploder.setOnComplete(()=>this.onAnimationComplete()),this.burner.setOnComplete(()=>this.onAnimationComplete()),this.createDestructionButtons(),this.setupEventListeners(),window.addEventListener("beforeunload",()=>this.stop())}setupEventListeners(){const t=this.canvas.getElement();t.addEventListener("mousedown",this.handlePointerStart.bind(this)),t.addEventListener("mousemove",this.handlePointerMove.bind(this)),t.addEventListener("mouseup",this.handlePointerEnd.bind(this)),t.addEventListener("mouseout",this.handlePointerEnd.bind(this)),t.addEventListener("touchstart",this.handleTouchStart.bind(this)),t.addEventListener("touchmove",this.handleTouchMove.bind(this)),t.addEventListener("touchend",this.handleTouchEnd.bind(this))}handlePointerStart(t){if(t.preventDefault(),this.gameState.isAnimationPlaying())return;const{offsetX:i,offsetY:s}=t;this.destructionMethodUsed&&(this.hammerSmash.reset(),this.exploder.reset(),this.burner.reset(),this.doodleManager.clearPaths(),this.destructionMethodUsed=!1),this.gameState.setDrawing(!0),this.doodleManager.startPath(i,s)}handlePointerMove(t){if(!this.gameState.isDrawing())return;const{offsetX:i,offsetY:s}=t;this.doodleManager.addPoint(i,s),this.render()}handlePointerEnd(t){t.preventDefault(),this.gameState.setDrawing(!1),this.doodleManager.endPath()}handleTouchStart(t){if(t.preventDefault(),t.touches.length!==1||this.gameState.isAnimationPlaying())return;const i=t.touches[0],s=this.canvas.getElement().getBoundingClientRect(),e=i.clientX-s.left,n=i.clientY-s.top;this.destructionMethodUsed&&(this.hammerSmash.reset(),this.exploder.reset(),this.burner.reset(),this.doodleManager.clearPaths(),this.destructionMethodUsed=!1),this.gameState.setDrawing(!0),this.doodleManager.startPath(e,n)}handleTouchMove(t){if(t.preventDefault(),!this.gameState.isDrawing()||t.touches.length!==1)return;const i=t.touches[0],s=this.canvas.getElement().getBoundingClientRect(),e=i.clientX-s.left,n=i.clientY-s.top;this.doodleManager.addPoint(e,n),this.render()}handleTouchEnd(t){t.preventDefault(),this.gameState.setDrawing(!1),this.doodleManager.endPath()}createDestructionButtons(){const t=document.getElementById("controls");if(!t){console.error("Controls container not found!");return}this.destructionButtons=document.createElement("div"),this.destructionButtons.className="destruction-buttons";const i=[{id:l.HAMMER,label:"🔨 Hammer",color:"#4CAF50"},{id:l.EXPLOSION,label:"💥 Explode",color:"#FF9800"},{id:l.FIRE,label:"🔥 Burn",color:"#F44336"}];for(const n of i){const r=document.createElement("button");r.textContent=n.label;let h="";switch(n.id){case l.HAMMER:h="hammer";break;case l.EXPLOSION:h="explosion";break;case l.FIRE:h="fire";break}r.className=`destruction-button ${h}`,r.addEventListener("click",()=>{this.startAnimation(n.id)}),this.destructionButtons.appendChild(r)}const s=document.createElement("button");s.textContent="🔄 Reset",s.className="reset-button",s.addEventListener("click",()=>{this.resetGame()}),this.destructionButtons.appendChild(s),this.destructionButtons.querySelectorAll("button").forEach(n=>{n.disabled=!0}),t.appendChild(this.destructionButtons)}startAnimation(t){if(this.gameState.isAnimationPlaying())return;this.stop(),this.gameState.setDestructionMethod(t),this.gameState.setAnimating(!0),this.gameState.setDrawing(!1),this.destructionMethodUsed=!0,this.destructionButtons.querySelectorAll("button").forEach(e=>{e.disabled=!0});const s=this.doodleManager.getPaths();switch(t){case l.HAMMER:this.hammerSmash.setPaths(s),this.hammerSmash.start();break;case l.EXPLOSION:this.exploder.setPaths(s),this.exploder.start();break;case l.FIRE:this.burner.setPaths(s),this.burner.start();break}this.start()}onAnimationComplete(){this.stop();const t=this.gameState.getDestructionMethod();if(this.gameState.setAnimating(!1),this.gameState.setDestructionMethod(l.NONE),t===l.HAMMER){const s=this.hammerSmash.getPaths();this.doodleManager.setPaths(s)}else this.doodleManager.clearPaths();const i=this.destructionButtons.querySelector("button:last-child");i&&i.classList.remove("disabled"),this.start()}resetGame(){this.stop(),this.hammerSmash.reset(),this.exploder.reset(),this.burner.reset(),this.gameState.reset(),this.destructionMethodUsed=!1,this.doodleManager.clearPaths(),this.destructionButtons.querySelectorAll("button").forEach(i=>{i.disabled=!0}),this.start()}hasValidDoodle(){const t=this.doodleManager.getPaths();return t.length>0&&t.some(i=>i.points.length>1)}render(){if(this.renderer.clear(),this.gameState.isAnimationPlaying())switch(this.gameState.getDestructionMethod()){case l.HAMMER:this.hammerSmash.update(),this.hammerSmash.draw();break;case l.EXPLOSION:this.exploder.update(),this.exploder.draw();break;case l.FIRE:this.burner.update(),this.burner.draw();break}else{this.renderer.drawDoodle(this.doodleManager.getPaths());const t=this.hasValidDoodle();this.destructionButtons.querySelectorAll("button").forEach(s=>{s.disabled=!t})}}gameLoop(){this.render(),this.animationFrameId=requestAnimationFrame(this.gameLoop.bind(this))}start(){this.gameLoop()}stop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}}const w=document.getElementById("canvas-container");w?new j(w).start():console.error("Canvas container not found!");
